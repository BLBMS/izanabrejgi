/* 032 */
// Upravljanje jezikov

// JEZIKOVNI PODATKI - VGRADIMO JIH V JS
const embeddedLanguageData = {
    "languages-version": "027",
    "languages": {
        "sl": {
            "meta": {
                "title": "Iža na brejgi",
                "description": "Počitniška hiša v Moravskih Topliceh, Prekmurje"
            },
            "nav": {
                "home": "Domov",
                "description": "Opis",
                "about": "Ponujamo",
                "contact": "Kontakti",
                "map": "Zemljevid",
                "reserve": "Rezerviraj"
            },
            "overlays": {
                "description": {
                    "title": "Opis",
                    "content": [
                        "Vrnite se v čase vaših dedkov in babic v prijetno hiško na mirni lokaciji med vinogradi, vendar na sodoben način z vsem udobjem današnjega časa.",
                        "Zaspite v tišini in v soju lune, zbudite se s ptičjim petjem.",
                        "Lahko uživate v naravi na lastnem dvorišču, lahko raziskujete okolico peš ali s kolesom po označenih poteh, lahko pa tudi uživate v bližnjih termalnih kopališčih.",
                        "Prevod iz prekmurščine je Hiša na griču. Beseda grič se lokalno ne uporablja, namesto nje je v uporabi beseda breg, ki je kot hrib, ali narečno brejg. Za prebivalce Spodnjih Moravec (to je nižinski del sedanjih Moravskih Toplic) je bila prva vzpetina v zaledju vasi uporabna predvsem za vinograde. Bolj ravninske predele v bližini kmetij pa so uporabljali kot kmetijska zemljišča.",
                        "Prva omemba hiše datira v leto 1864 in je že označena na prvih kartah. Prvotni namen stavbe je bila viničarija, kjer so živeli delavci s svojimi družinami in so skrbeli za te vinograde. Vinogradi in objekti pa so bili v lasti premožnejših kmetov iz spodnjega dela vasi.",
                        "Hiša je opremljena z restavriranim stilnim pohištvom takratnega časa in veliko kosov presega častitljivo starost 100 let.",
                        "Potrudili smo se, da vas popeljemo na potovanje v preteklost, da si vzamete čas za sebe in svoje najbližje ter mogoče tudi za razmislek o nekdanjih vrednotah, ki v tem prehitrem svetu vedno bolj izginjajo.",
                        "Prosimo, da hišo in pohištvo uporabljate skrbno in pazljivo, da ga bomo čez naslednjih 100 let lahko predali našim vnukom in pravnukom v takem stanju, kot so nam ga predali naši predniki."
                    ]
                },
                "about": {
                    "title": "Ponujamo",
                    "intro1": "Počitniška hiša za 1-4 osebe vključuje:",
                    "items1": [
                        "ločeno spalnico",
                        "dodatnim ležiščem v dnevnem prostoru",
                        "jedilnico",
                        "celotno opremljeno kuhinjo",
                        "kopalnico s tušem",
                        "dodatnim straniščem",
                        "pokrito teraso",
                        "prostor za shranjevanje koles",
                        "dvema parkirnima mestoma",
                        "televizijo, Wi-Fi, ..."
                    ],
                    "intro2": "Dodatne informacije",
                    "items2": [
                        "Cenik velja za najem za 1 do 2 osebi na nočitev.",
                        "Za 3. do 4. osebo je doplačilo na osnovno ceno.",
                        "Hišni ljubljenčki niso dovoljeni.",
                        "Kajenje ni dovoljeno.",
                        "Turistična taksa se plača posebej:",
                        "  - polnoletne osebe 2,50 € na noč,",
                        "  - otroci od 7 do 18 let 1,25 € na noč,",
                        "  - Otroci do 7 let in invalidi so opravičeni do plačila turistične takse.",
                        "Vse cene so v EUR. Ne poslujemo z gotovino."
                    ]
                },
                "contact": {
                    "title": "Kontakti",
                    "phone": "Telefon:",
                    "phoneValue": "+386 41 563 873 Tanja",
                    "email": "Email:",
                    "emailValue": "iza.na.breigi@gmail.com",
                    "address": "Naslov:",
                    "addressLines": [
                        "Rumičev breg 71",
                        "9226 Moravske Toplice",
                        "Goričko, Prekmurje, Slovenija"
                    ]
                },
            },
            "footer": {
                "copyright": "&copy; 2025 Iža na brejgi. Vse pravice pridržane."
            }
        },
        "en": {
            "meta": {
                "title": "Iža na brejgi",
                "description": "Holiday house in Moravske Toplice, Prekmurje"
            },
            "nav": {
                "home": "Home",
                "description": "Description",
                "about": "We offer",
                "contact": "Contacts",
                "map": "Map",
                "reserve": "Book"
            },
            "overlays": {
                "description": {
                    "title": "Description",
                    "content": [
                        "Return to the times of your grandparents in a cosy little house in a peaceful location among the vineyards - but in a modern way, with all the comfort of today.",
                        "Fall asleep in silence under the moonlight and wake up to the singing of birds.",
                        "You can enjoy nature in your own yard, explore the surroundings on foot or by bike along marked trails, or relax in the nearby thermal spas.",
                        "The translation from the local Prekmurje dialect is 'House on the Hill'. The word grič ('hill') is not used locally; instead, people use breg, which also means a hill, or the dialect version brejg. For the inhabitants of Spodnje Moravce (the lower part of today's Moravske Toplice), the first elevation behind the village was mainly used for vineyards. The flatter areas near the farms were used as agricultural land.",
                        "The first mention of the house dates back to 1864, and it is already marked on the earliest maps. The original purpose of the building was a viničarija - a vintner's house where workers and their families lived while taking care of the vineyards. The vineyards and the buildings were owned by the wealthier farmers from the lower part of the village.",
                        "The house is furnished with restored period furniture, and many pieces are more than 100 years old.",
                        "We have made an effort to take you on a journey into the past - to allow you to take time for yourself and your loved ones, and perhaps to reflect on the old values that are increasingly disappearing in today's fast-paced world.",
                        "Please use the house and furniture with care, so that we can pass them on to our grandchildren and great-grandchildren in the same condition in which they were handed down to us."
                    ]
                },
                "about": {
                    "title": "We offer",
                    "intro1": "A holiday house for 1-4 people includes:",
                    "items1": [
                        "a separate bedroom",
                        "an additional bed in the living room",
                        "a dining area",
                        "a fully equipped kitchen",
                        "a bathroom with shower",
                        "an extra toilet",
                        "a covered terrace",
                        "a storage space for bicycles",
                        "two parking spaces",
                        "Wi-Fi, television, internet radio, ..."
                    ],
                    "intro2": "Additional Information",
                    "items2": [
                        "Price list applies to rental for 1 to 2 persons per night.",
                        "For 3rd to 4th person: surcharge on basic price.",
                        "Pets are not allowed.",
                        "Smoking is not permitted.",
                        "Tourist tax is paid separately:",
                        "  - adults 2.50 € per night,",
                        "  - children from 7 to 18 years 1.25 € per night,",
                        "  - Children up to 7 years and disabled persons are exempt from tourist tax.",
                        "All prices are in EUR. We do not accept cash."
                    ]
                },
                "contact": {
                    "title": "Contacts",
                    "phone": "Phone:",
                    "phoneValue": "+386 41 563 873 Tanja",
                    "email": "Email:",
                    "emailValue": "iza.na.brejgi@gmail.com",
                    "address": "Address:",
                    "addressLines": [
                        "Rumičev breg 71",
                        "9226 Moravske Toplice",
                        "Goričko, Prekmurje, Slovenia"
                    ]
                },
            },
            "footer": {
                "copyright": "&copy; 2025 Iža na brejgi. All rights reserved."
            }
        },
        "de": {
            "meta": {
                "title": "Iža na brejgi",
                "description": "Ferienhaus in Moravske Toplice, Prekmurje"
            },
            "nav": {
                "home": "Startseite",
                "description": "Beschreibung",
                "about": "Wir bieten",
                "contact": "Kontakt",
                "map": "Karte",
                "reserve": "Buchen"
            },
            "overlays": {
                "description": {
                    "title": "Beschreibung",
                    "content": [
                        "Reisen Sie zurück in die Zeit Ihrer Großeltern - in ein gemütliches Häuschen an einem ruhigen Ort zwischen Weinbergen, jedoch modern ausgestattet mit allen Annehmlichkeiten der heutigen Zeit.",
                        "Schlafen Sie in völliger Stille im Mondschein ein und erwachen Sie mit dem Gesang der Vögel.",
                        "Sie können die Natur im eigenen Hof genießen, die Umgebung zu Fuß oder mit dem Fahrrad auf markierten Wegen erkunden oder die nahegelegenen Thermen besuchen.",
                        "Die Übersetzung aus dem lokalen Dialekt Prekmurje lautet 'Haus am Hügel'. Das Wort grič ('Hügel') wird hier jedoch nicht verwendet; stattdessen sagt man breg, was ebenfalls einen Hügel bezeichnet, oder mundartlich brejg. Für die Bewohner von Spodnje Moravce (dem tiefer gelegenen Teil des heutigen Moravske Toplice) war die erste Anhöhe hinter dem Dorf vor allem für Weinberge bestimmt. Die flacheren Gebiete in der Nähe der Bauernhöfe nutzte man als Ackerland.",
                        "Die erste Erwähnung des Hauses stammt aus dem Jahr 1864, und es ist bereits auf den ältesten Karten eingezeichnet. Ursprünglich diente das Gebäude als Viničarija - ein Winzerhaus, in dem Arbeiter mit ihren Familien lebten und die Weinberge betreuten. Die Weinberge und Gebäude gehörten wohlhabenderen Bauern aus dem unteren Teil des Dorfes.",
                        "Das Haus ist mit restaurierten Möbeln aus jener Zeit ausgestattet, von denen viele über 100 Jahre alt sind.",
                        "Wir haben uns bemüht, Sie auf eine Reise in die Vergangenheit mitzunehmen - damit Sie Zeit für sich und Ihre Liebsten finden und vielleicht auch an die alten Werte denken, die in unserer schnelllebigen Welt immer mehr verloren gehen.",
                        "Bitte gehen Sie mit dem Haus und den Möbeln sorgsam um, damit wir sie in demselben Zustand unseren Enkeln und Urenkeln weitergeben können, wie sie uns von unseren Vorfahren überliefert wurden."
                    ]
                },
                "about": {
                    "title": "Wir bieten",
                    "intro1": "Ein Ferienhaus für 1-4 Personen inklusive:",
                    "items1": [
                        "einem separaten Schlafzimmer",
                        "einer zusätzlichen Schlafgelegenheit im Wohnbereich",
                        "einem Essbereich",
                        "einer komplett ausgestatteten Küche",
                        "einem Badezimmer mit Dusche",
                        "einer zusätzlichen Toilette",
                        "einer überdachten Terrasse",
                        "einem Abstellraum für Fahrräder",
                        "zwei Parkplätzen",
                        "WLAN, Fernseher, Internetradio, ..."
                    ],
                    "intro2": "Zusätzliche Informationen",
                    "items2": [
                        "Preisliste gilt für Vermietung für 1 bis 2 Personen pro Nacht.",
                        "Für 3. bis 4. Person: Aufschlag auf den Grundpreis.",
                        "Haustiere sind nicht erlaubt.",
                        "Rauchen ist nicht gestattet.",
                        "Tourismusabgabe wird separat bezahlt:",
                        "  - Erwachsene 2,50 € pro Nacht,",
                        "  - Kinder von 7 bis 18 Jahren 1,25 € pro Nacht,",
                        "  - Kinder bis 7 Jahre und behinderte Personen sind von der Tourismusabgabe befreit.",
                        "Alle Preise sind v EUR. Wir akzeptieren kein Bargeld."
                    ]
                },
                "contact": {
                    "title": "Kontakt",
                    "phone": "Telefon:",
                    "phoneValue": "+386 41 563 873 Tanja",
                    "email": "E-Mail:",
                    "emailValue": "iza.na.breigi@gmail.com",
                    "address": "Adresse:",
                    "addressLines": [
                        "Rumičev breg 71",
                        "9226 Moravske Toplice",
                        "Goričko, Prekmurje, Slowenien"
                    ]
                },
            },
            "footer": {
                "copyright": "&copy; 2025 Iža na brejgi. Alle Rechte vorbehalten."
            }
        }
    }
};

// Naloži jezikovne podatke
function loadLanguageData() {
    try {
        // Uporabi vgrajene podatke namesto fetch
        window.languageData = embeddedLanguageData.languages;

        // Nastavi privzeti jezik glede na lokacijo/brskalnik
        window.currentLanguage = detectLanguageByLocation();

        // Uporabi jezik
        applyLanguage(window.currentLanguage);

        // Inicializiraj zastavice
        initLanguageFlags();

    } catch (error) {
        console.error('Napaka pri nalaganju jezikovnih podatkov:', error);
        window.currentLanguage = 'sl';
        // Prikaži vsaj slovensko verzijo
        if (embeddedLanguageData.languages.sl) {
            window.languageData = embeddedLanguageData.languages;
            applyLanguage('sl');
        }
    }
}

// Določi jezik glede na lokacijo
function detectLanguageByLocation() {
    // Preveri URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const langParam = urlParams.get('lang');

    if (langParam && ['sl', 'en', 'de'].includes(langParam)) {
        return langParam;
    }

    // Preveri glede na jezik brskalnika
    const userLang = navigator.language || navigator.userLanguage;

    if (userLang.startsWith('sl')) {
        return 'sl';
    } else if (userLang.startsWith('de')) {
        return 'de';
    } else {
        return 'en';
    }
}

// Uporabi jezik
function applyLanguage(lang) {
    if (!languageData[lang]) return;

    const data = languageData[lang];
    currentLanguage = lang;

    // Posodobi naslov strani
    document.title = data.meta.title;
    document.documentElement.lang = lang;

    // Posodobi navigacijo
    updateNavigation(data.nav);

    // Posodobi naslove overlayev
    updateOverlayTitles(data.overlays);

    // Posodobi vsebino overlayev
    updateOverlayContent(lang);

    // Posodobi footer
    updateFooter(data.footer);

    // Posodobi aktivno zastavo
    updateActiveFlag(lang);

    // Shrani jezik v localStorage
    localStorage.setItem('preferredLanguage', lang);
}

// Posodobi navigacijo
function updateNavigation(navData) {
    const navIds = {
        'nav-home': 'home',
        'nav-description': 'description',
        'nav-about': 'about',
        'nav-contact': 'contact',
        'nav-map': 'map',
        'nav-reserve': 'reserve'
    };

    for (const [elementId, dataKey] of Object.entries(navIds)) {
        const element = document.getElementById(elementId);
        if (element && navData[dataKey]) {
            element.textContent = navData[dataKey];
        }
    }
}

// Posodobi naslove overlayev
function updateOverlayTitles(overlaysData) {
    const titleIds = {
        'description-title': 'description.title',
        'about-title': 'about.title',
        'contact-title': 'contact.title',
    };

    for (const [elementId, dataPath] of Object.entries(titleIds)) {
        const element = document.getElementById(elementId);
        if (element) {
            const value = getValueByPath(overlaysData, dataPath);
            if (value) {
                element.textContent = value;
            }
        }
    }
}

// Pomožna funkcija za dostop do nested objektov
function getValueByPath(obj, path) {
    return path.split('.').reduce((current, key) => current?.[key], obj);
}

// Posodobi vsebino overlayev
function updateOverlayContent(lang) {
    const data = languageData[lang];
    if (!data) return;

    updateDescriptionContent(data.overlays.description);
    updateAboutContent(data.overlays.about);
    updateContactContent(data.overlays.contact);
}

// Posodobi opis overlay
function updateDescriptionContent(descriptionData) {
    const descriptionContent = document.getElementById('description-content');
    if (descriptionContent && descriptionData.content) {
        let html = '';
        descriptionData.content.forEach(paragraph => {
            html += `<p>${paragraph}</p>`;
        });
        descriptionContent.innerHTML = html;
    }
}

// Posodobi "ponujamo" overlay
function updateAboutContent(aboutData) {
    const aboutContent = document.getElementById('about-content');
    if (aboutContent && aboutData) {
        let html = '';

        // PRVI DEL - Ponujamo
        if (aboutData.intro1 && aboutData.items1) {
            html += `<h3 class="about-subtitle">${aboutData.intro1}</h3>`;
            html += '<ul class="about-list">';
            aboutData.items1.forEach(item => {
                html += `<li>${item}</li>`;
            });
            html += '</ul>';
        }

        // DRUGI DEL - Dodatne informacije
        if (aboutData.intro2 && aboutData.items2) {
            html += `<div class="additional-info-section">`;
            html += `<h3 class="additional-info-title">${aboutData.intro2}</h3>`;
            html += '<ul class="additional-info-list">';
            aboutData.items2.forEach(item => {
                html += `<li>${item}</li>`;
            });
            html += '</ul>';
            html += `</div>`;
        }

        aboutContent.innerHTML = html;
    }
}

// Posodobi kontakt overlay
function updateContactContent(contactData) {
    const contactContent = document.getElementById('contact-content');
    if (contactContent && contactData) {
        let html = `
            <div class="contact-item">
                <span class="contact-label">${contactData.phone}</span>
                <span class="contact-value">${contactData.phoneValue}</span>
            </div>
            <div class="contact-item">
                <span class="contact-label">${contactData.email}</span>
                <span class="contact-value">${contactData.emailValue}</span>
            </div>
            <div class="contact-item">
                <span class="contact-label">${contactData.address}</span>
                <div class="contact-value address">
        `;
        contactData.addressLines.forEach(line => {
            html += `<div>${line}</div>`;
        });
        html += `</div></div>`;
        contactContent.innerHTML = html;
    }
}

// Posodobi footer
function updateFooter(footerData) {
    const footerText = document.getElementById('footer-text');
    if (footerText && footerData.copyright) {
        footerText.innerHTML = footerData.copyright;
    }
}

// Inicializiraj zastavice
function initLanguageFlags() {
    const flagElements = document.querySelectorAll('.language-flag');

    flagElements.forEach(flag => {
        flag.addEventListener('click', function (e) {
            e.preventDefault();
            const lang = this.getAttribute('data-lang');
            switchLanguage(lang);
        });
    });
}

// Posodobi aktivno zastavo
function updateActiveFlag(lang) {
    const flagElements = document.querySelectorAll('.language-flag');

    flagElements.forEach(flag => {
        const flagLang = flag.getAttribute('data-lang');
        if (flagLang === lang) {
            flag.classList.add('active-flag');
        } else {
            flag.classList.remove('active-flag');
        }
    });
}

// Zamenjaj jezik
function switchLanguage(lang) {
    if (languageData[lang]) {
        applyLanguage(lang);
        // Posodobi URL brez osveževanja strani
        const url = new URL(window.location);
        url.searchParams.set('lang', lang);
        window.history.pushState({}, '', url);

        // OSVEŽI ZEMLJEVID ČE JE ODPRT
        if (typeof refreshMapLanguage === 'function') {
            setTimeout(() => {
                refreshMapLanguage(lang);
            }, 100);
        }
    }
}

// Eksport funkcij
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        loadLanguageData,
        applyLanguage,
        switchLanguage,
        detectLanguageByLocation
    };

}
